---
title: "[Spring Security] Logout ì„¤ì •"
date: 2025-01-08
categories: "spring-security"
comments: true
---

Spring SecurityëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `DefaultLogoutPageGeneratingFilter`ë¥¼ í†µí•´ ë¡œê·¸ì•„ì›ƒ í˜ì´ì§€ë¥¼ ì œê³µí•˜ë©° `GET` `/logout`ìœ¼ë¡œ ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.

ë¡œê·¸ì•„ì›ƒ ì‹¤í–‰ì€ ê¸°ë³¸ì ìœ¼ë¡œ `POST` `/logout`ìœ¼ë¡œë§Œ ê°€ëŠ¥í•˜ë©° csrf ê¸°ëŠ¥ì„ ë¹„í™œì„±í™” í•  ê²½ìš° ë˜ëŠ” RequestMatcher ë¥¼ ì‚¬ìš©í•  ê²½ìš° GET, PUT, DELETE ëª¨ë‘ ê°€ëŠ¥í•˜ë‹¤.

ë¡œê·¸ì•„ì›ƒ í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  MVCì—ì„œ ì»¤ìŠ¤í…€ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆìœ¼ë©°, ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ì»¤ìŠ¤í…€ìœ¼ë¡œ êµ¬í˜„í–ˆì„ ê²½ìš° ë¡œê·¸ì•„ì›ƒ ë˜í•œ ì»¤ìŠ¤í…€ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•œë‹¤.

ì•„ë˜ëŠ” logout config ì„¤ì •ë“¤ì´ë‹¤.

```java
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

  http.authorizeHttpRequests(auth -> auth
        .requestMatchers("/logoutSuccess").permitAll()
        .anyRequest().authenticated());

  http.formLogin(Customizer.withDefaults());

  http.logout(logout -> logout
        .logoutUrl("/logout")   // ë¡œê·¸ì•„ì›ƒì´ ë°œìƒí•˜ëŠ” URLì§€ì • (default : /logout)
        .logoutRequestMatcher(new AntPathRequestMatcher("/logout", "POST")) // logoutUrlê³¼ logoutRequestMatcherê°€ ë‘˜ë‹¤ ì„¤ì •ë˜ì–´ìˆì„ê²½ìš° RequestMatcherê°€ ìš°ì„ ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.
        .logoutSuccessUrl("/logoutSuccess") // ë¡œê·¸ì•„ì›ƒì´ ëœ í›„ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë  URLì§€ì • (default: /login?logout)
        .logoutSuccessHandler(new LogoutSuccessHandler() {  // ì‚¬ìš©í•  logout handlerë¥¼ ì„¤ì •í•œë‹¤. handlerëŠ” ìœ„ì—ì„œ í•œ ì„¤ì •ë³´ë‹¤ ìš°ì„ ì ìœ¼ë¡œ ì‹¤í–‰ëœë‹¤.
            @Override
            public void onLogoutSuccess(HttpServletRequest request, HttpServletResponse response, Authentication authentication) throws IOException, ServletException {
                response.sendRedirect("/logoutSuccess");    // ì´ë ‡ê²Œ ë˜ë©´ ìœ„ì—ì„œ ì„¤ì •í•œ logoutSuccessUrlì€ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.
            }
        })
        .deleteCookies("JSESSIONID", "remember-me") // ë¡œê·¸ì•„ì›ƒ ì‹œ ì‚­ì œí•  ì¿ í‚¤ë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
        .invalidateHttpSession(true)    // HttpSessionì„ ë¬´íš¨í™” í•œë‹¤. (default : true)
        .clearAuthentication(true)  // ë¡œê·¸ì•„ì›ƒ ì‹œ SecurityContextLogoutHandlerê°€ ì¸ì¦ê°ì²´(Authentication)ì„ ì‚­ì œí•œë‹¤.
        .addLogoutHandler(new LogoutHandler() {
            @Override
            public void logout(HttpServletRequest request, HttpServletResponse response, Authentication authentication) {
                HttpSession session = request.getSession();
                session.invalidate();
                SecurityContextHolder.getContextHolderStrategy().getContext().setAuthentication(null);  // security contextì— ì €ì¥ëœ authentication ê°ì²´ë¥¼ ì—†ì•¤ë‹¤.
                SecurityContextHolder.getContextHolderStrategy().clearContext();    // security context ì´ˆê¸°í™”ë¥¼ í•œë‹¤.
            }
        })
        .permitAll()); // logoutUrl(), RequestMatcher()ì˜ URLì— ëŒ€í•œ ëª¨ë“  ì ‘ê·¼ì„ í—ˆìš©í•œë‹¤.

  return http.build();
}
```

ë¡œê·¸ì•„ì›ƒ í• ë•Œ ë³„ë‹¤ë¥¸ ì»¤ìŠ¤í…€ ê¸°ëŠ¥ì´ ì—†ë‹¤ë©´ ë”°ë¡œ ì„¤ì •ì„ í•  í•„ìš”ëŠ” ê±°ì˜ ì—†ë‹¤. ë§Œì•½ í•„ìš”í•˜ë‹¤ë©´ ìœ„ì™€ê°™ì€ ì„¤ì •ë“¤ì„ í•´ì£¼ë©´ ëœë‹¤.

#### ğŸ“Œ logoutSuccessHandler
ì´ í•¸ë“¤ëŸ¬ëŠ” ì´ë¦„ì—ì„œë„ ì•Œ ìˆ˜ ìˆë“¯ì´ logoutì„ ì„±ê³µí•˜ê²Œ ë˜ë©´ ì‹¤í–‰ë˜ëŠ” í•¸ë“¤ëŸ¬ì´ë‹¤. ìœ„ì—ì„œëŠ” ë¡œê·¸ì•„ì›ƒ ì‹œ `/logoutSuccess`ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ í•˜ë„ë¡ ì„¤ì •ì´ í–ˆë‹¤.

(ì£¼ì˜í• ì ì€ ë¡œê·¸ì•„ì›ƒì„ í•  ê²½ìš° ì¸ì¦ ìƒíƒœê°€ ì‚¬ë¼ì§€ê¸° ë•Œë¬¸ì— `http.anyRequest().authenticaiton()` ì„¤ì •ìœ¼ë¡œ ì¸í•´ í˜ì´ì§€ ì´ë™ì´ ì •ìƒì ìœ¼ë¡œ ì•ˆë  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ `http.requestMatcher("logoutSuccess").permitAll()` ì„¤ì •ì„ ë”°ë¡œ í•´ì£¼ì—ˆë‹¤.)

#### ğŸ“Œ addLogoutHandler
ì„¤ì • ì¤‘ `addLogoutHandler` ì„¤ì •ì´ ìˆëŠ”ë°, ë¡œê·¸ì•„ì›ƒì„ í•  ë•Œ Spring Security ë‚´ë¶€ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” í•¸ë“¤ëŸ¬ê°€ ëª‡ê°€ì§€ ìˆë‹¤. ê·¸ í•¸ë“¤ëŸ¬ë“¤ì´ ì‹¤í–‰ë  ë•Œ ì¶”ê°€ì ìœ¼ë¡œ ì»¤ìŠ¤í…€í•˜ì—¬ ì‹¤í–‰ì‹œí‚¬ ìˆ˜ ìˆëŠ” ì„¤ì •ì´ë‹¤.

ìœ„ì˜ ì½”ë“œì—ì„œëŠ” ë¡œê·¸ì•„ì›ƒì„ í•˜ê²Œ ë˜ë©´ security contextì—ì„œ authentication ê°ì²´ë¥¼ ì‚­ì œí•˜ê³  security contextë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ì½”ë“œë¥¼ ë„£ì—ˆëŠ”ë° ì´ ì‘ì—…ì€ ì›ë˜ ë™ì‘í•˜ëŠ” í•¸ë“¤ëŸ¬ì¤‘ SecurityContextLogoutHandlerë¼ëŠ” í•¸ë“¤ëŸ¬ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œì„ìœ¼ë¡œ ë”°ë¡œ ì‘ì„±ì€ ë¶ˆí•„ìš”í•˜ë‹¤. (ìœ„ì—ì„œëŠ” ê·¸ëƒ¥ ì˜ˆì‹œë¥¼ ìœ„í•´ ì‘ì„±í•œ ì½”ë“œì´ë‹¤.)